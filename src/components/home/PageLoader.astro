---
// 页面加载动画组件
---

<div class="page-loader" id="pageLoader">
    <div class="loader-content">
        <div class="loader-logo">
            <span class="logo-text">HUAT</span>
            <span class="logo-accent">FSAC</span>
        </div>
        <div class="loader-bar">
            <div class="loader-progress"></div>
        </div>
    </div>
</div>

<script>
    function initPageLoader() {
        const loaderEl = document.getElementById("pageLoader");
        if (!(loaderEl instanceof HTMLElement)) return;
        const loader = loaderEl;

        // P0: 性能优化 - 检查是否首次访问
        // 如果用户在本次会话中已经访问过，则不再显示加载动画
        const hasVisited = sessionStorage.getItem("huat_fsac_visited");

        if (hasVisited) {
            loader.style.display = "none";
            // 即使不显示动画，也要触发事件，保证依赖此事件的其他组件（如 Hero 动画）能正常运行
            window.dispatchEvent(new CustomEvent("pageLoaderHidden"));
            return;
        }

        // 标记本次会话已访问
        sessionStorage.setItem("huat_fsac_visited", "true");

        function hideLoader() {
            if (loader.classList.contains("loaded")) return;
            loader.classList.add("loaded");
            setTimeout(() => {
                loader.style.display = "none";
                // 触发自定义事件，通知其他组件可以开始动画了
                window.dispatchEvent(new CustomEvent("pageLoaderHidden"));
            }, 500);
        }

        // DOM 准备好就隐藏，不等待所有资源
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", hideLoader);
        } else {
            // DOM 已经准备好，立即隐藏
            hideLoader();
        }

        // P0: 强制超时销毁机制 (防止 JS 报错导致永久白屏)
        // 设置 3 秒超时，确保即使发生异常也能进入页面
        setTimeout(hideLoader, 3000);
    }

    // 立即执行
    initPageLoader();
</script>

<style>
    .page-loader {
        position: fixed;
        inset: 0;
        background: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 99999;
        transition:
            opacity 0.2s ease,
            visibility 0.2s ease;
    }

    :global([data-theme="light"]) .page-loader {
        background: #fff;
    }

    .page-loader.loaded {
        opacity: 0;
        visibility: hidden;
    }

    .loader-content {
        text-align: center;
    }

    .loader-logo {
        font-size: 3rem;
        font-weight: 900;
        letter-spacing: -2px;
        margin-bottom: 2rem;
    }

    .logo-text {
        color: #fff;
    }

    :global([data-theme="light"]) .logo-text {
        color: #000;
    }

    .logo-accent {
        color: var(--sl-color-accent, #f39c12);
        margin-left: 0.5rem;
    }

    .loader-bar {
        width: 200px;
        height: 3px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin: 0 auto;
    }

    :global([data-theme="light"]) .loader-bar {
        background: rgba(0, 0, 0, 0.1);
    }

    .loader-progress {
        height: 100%;
        width: 0%;
        background: linear-gradient(
            90deg,
            var(--sl-color-accent, #f39c12),
            #fff
        );
        border-radius: 3px;
        animation: loading 1.5s ease-in-out infinite;
    }

    @keyframes loading {
        0% {
            width: 0%;
            margin-left: 0%;
        }
        50% {
            width: 70%;
            margin-left: 15%;
        }
        100% {
            width: 0%;
            margin-left: 100%;
        }
    }
</style>
