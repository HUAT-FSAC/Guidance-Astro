---
// 社交分享按钮组件
interface Props {
    title?: string;
    url?: string;
}

const { title = "", url = "" } = Astro.props;
---

<div class="share-buttons">
    <span class="share-label">分享：</span>
    <button class="share-btn" data-platform="weibo" title="分享到微博">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path
                d="M10.098 20.323c-3.977.391-7.414-1.406-7.672-4.02-.259-2.609 2.759-5.047 6.74-5.441 3.979-.394 7.413 1.404 7.671 4.018.259 2.6-2.759 5.049-6.739 5.443zM9.05 17.219c-.384.616-1.208.884-1.829.602-.612-.279-.793-.991-.406-1.593.379-.595 1.176-.861 1.793-.601.622.263.82.972.442 1.592zm1.27-1.627c-.141.237-.449.353-.689.253-.236-.09-.313-.361-.177-.586.138-.227.436-.346.672-.24.239.09.315.36.194.573zm.176-2.719c-1.893-.493-4.033.45-4.857 2.118-.836 1.704-.026 3.591 1.886 4.21 1.983.64 4.318-.341 5.132-2.179.8-1.793-.201-3.642-2.161-4.149zm7.563-1.224c-.346-.105-.579-.18-.402-.649.386-1.02.426-1.899.001-2.528-.796-1.176-2.974-1.113-5.49-.034 0 0-.786.345-.585-.281.388-1.236.33-2.271-.276-2.868-1.373-1.36-5.027.05-8.16 3.147C.873 11.851 0 14.063 0 15.945c0 3.609 4.624 5.808 9.151 5.808 5.926 0 9.869-3.442 9.869-6.175 0-1.651-1.392-2.586-2.961-3.029zm1.063-4.908c-.083-.726-.717-1.259-1.418-1.191-.702.068-1.211.7-1.138 1.427.077.727.711 1.263 1.412 1.191.702-.064 1.221-.7 1.144-1.427zm2.503-.089c-.199-1.744-1.722-3.023-3.404-2.858-1.68.167-2.905 1.682-2.735 3.426.169 1.743 1.692 3.022 3.373 2.857 1.681-.168 2.936-1.681 2.766-3.425z"
            ></path>
        </svg>
    </button>
    <button class="share-btn" data-platform="twitter" title="分享到 Twitter">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path
                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
            ></path>
        </svg>
    </button>
    <button class="share-btn" data-platform="copy" title="复制链接">
        <svg
            viewBox="0 0 24 24"
            width="18"
            height="18"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
        >
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
            ></path>
        </svg>
    </button>
</div>

<script>
    function initShareButtons() {
        document.querySelectorAll(".share-btn").forEach((btn) => {
            btn.addEventListener("click", async () => {
                const platform = (btn as HTMLElement).dataset.platform;
                const pageTitle = document.title;
                const pageUrl = window.location.href;

                switch (platform) {
                    case "weibo":
                        window.open(
                            `https://service.weibo.com/share/share.php?title=${encodeURIComponent(pageTitle)}&url=${encodeURIComponent(pageUrl)}`,
                            "_blank",
                        );
                        break;
                    case "twitter":
                        window.open(
                            `https://twitter.com/intent/tweet?text=${encodeURIComponent(pageTitle)}&url=${encodeURIComponent(pageUrl)}`,
                            "_blank",
                        );
                        break;
                    case "copy":
                        try {
                            await navigator.clipboard.writeText(pageUrl);
                            btn.classList.add("copied");
                            setTimeout(
                                () => btn.classList.remove("copied"),
                                2000,
                            );
                        } catch (err) {
                            console.error("复制失败:", err);
                        }
                        break;
                }
            });
        });
    }

    document.addEventListener("DOMContentLoaded", initShareButtons);
    document.addEventListener("astro:page-load", initShareButtons);
</script>

<style>
    .share-buttons {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 0;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        margin-top: 2rem;
    }

    :global([data-theme="light"]) .share-buttons {
        border-color: rgba(0, 0, 0, 0.1);
    }

    .share-label {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.6);
    }

    :global([data-theme="light"]) .share-label {
        color: var(--sl-color-gray-3);
    }

    .share-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    :global([data-theme="light"]) .share-btn {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.1);
        color: var(--sl-color-gray-3);
    }

    .share-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--sl-color-accent);
        border-color: var(--sl-color-accent);
        transform: translateY(-2px);
    }

    :global([data-theme="light"]) .share-btn:hover {
        background: rgba(0, 0, 0, 0.1);
    }

    .share-btn.copied {
        background: rgba(46, 204, 113, 0.2);
        border-color: #2ecc71;
        color: #2ecc71;
    }

    .share-btn.copied::after {
        content: "已复制";
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: #2ecc71;
        color: #000;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        white-space: nowrap;
    }
</style>
