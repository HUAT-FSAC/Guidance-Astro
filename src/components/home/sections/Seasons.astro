---
import type { SeasonItem } from "../../../data/home";

interface Props {
    seasons: SeasonItem[];
}

const { seasons } = Astro.props;
---

<div class="seasons-carousel-container">
    <div class="carousel-viewport" id="seasonsViewport">
        <div class="carousel-track" id="seasonsTrack">
            {
                seasons.map((season, index) => (
                    <div class="carousel-slide" data-index={index}>
                        <div class="season-card">
                            <div class="season-header">
                                <div class="season-year">{season.year}</div>
                                <div class="season-badge">Season Team</div>
                            </div>

                            <div class="season-content">
                                {/* å›¾ç‰‡å±•ç¤ºåŒº */}
                                <div class="season-gallery">
                                    <div class="gallery-item">
                                        <img
                                            src={season.teamImg}
                                            alt={`${season.year} Team`}
                                            loading="lazy"
                                        />
                                        <div class="gallery-caption">
                                            The Team
                                        </div>
                                    </div>
                                    <div class="gallery-item">
                                        <img
                                            src={season.carImg}
                                            alt={`${season.year} Car`}
                                            loading="lazy"
                                        />
                                        <div class="gallery-caption">
                                            The Machine
                                        </div>
                                    </div>
                                </div>

                                {/* å›¢é˜Ÿä¿¡æ¯åŒº */}
                                <div class="team-info">
                                    {/* æŒ‡å¯¼è€å¸ˆå’Œé˜Ÿé•¿ */}
                                    <div class="leadership">
                                        {season.advisor && (
                                            <div class="leader-card">
                                                <div class="leader-icon">
                                                    ğŸ‘¨â€ğŸ«
                                                </div>
                                                <div class="leader-details">
                                                    <span class="leader-role">
                                                        æŒ‡å¯¼è€å¸ˆ
                                                    </span>
                                                    <span class="leader-name">
                                                        {season.advisor}
                                                    </span>
                                                </div>
                                            </div>
                                        )}
                                        {season.captain && (
                                            <div class="leader-card">
                                                <div class="leader-icon">
                                                    ğŸ–ï¸
                                                </div>
                                                <div class="leader-details">
                                                    <span class="leader-role">
                                                        é˜Ÿé•¿
                                                    </span>
                                                    <span class="leader-name">
                                                        {season.captain}
                                                    </span>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* æˆå‘˜åˆ—è¡¨ */}
                                    {season.members &&
                                        season.members.length > 0 && (
                                            <div class="members-section">
                                                <div class="members-grid">
                                                    {season.members.map(
                                                        (group: { group: string; names: string[] }) => (
                                                            <div class="member-group">
                                                                <div class="group-name">
                                                                    {
                                                                        group.group
                                                                    }
                                                                </div>
                                                                <div class="group-members">
                                                                    {group.names.map(
                                                                        (
                                                                            name: string,
                                                                        ) => (
                                                                            <span class="member-name">
                                                                                {
                                                                                    name
                                                                                }
                                                                            </span>
                                                                        ),
                                                                    )}
                                                                </div>
                                                            </div>
                                                        ),
                                                    )}
                                                </div>
                                            </div>
                                        )}
                                </div>
                            </div>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>

    {/* å¯¼èˆªæŒ‰é’® */}
    <button class="carousel-nav prev" id="prevBtn" aria-label="Previous Season">
        <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg
        >
    </button>
    <button class="carousel-nav next" id="nextBtn" aria-label="Next Season">
        <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg
        >
    </button>

    {/* æŒ‡ç¤ºå™¨ */}
    <div class="carousel-indicators">
        {
            seasons.map((_, index) => (
                <button
                    class={`indicator ${index === 0 ? "active" : ""}`}
                    data-index={index}
                    aria-label={`Go to slide ${index + 1}`}
                />
            ))
        }
    </div>
</div>

<script>
    function initCarousel() {
        const track = document.getElementById("seasonsTrack");
        const slides = document.querySelectorAll(".carousel-slide");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const indicators = document.querySelectorAll(".indicator");

        if (!track || slides.length === 0) return;

        let currentIndex = 0;
        const totalSlides = slides.length;

        function updateCarousel() {
            // ç§»åŠ¨è½¨é“
            track!.style.transform = `translateX(-${currentIndex * 100}%)`;

            // æ›´æ–°æŒ‡ç¤ºå™¨
            indicators.forEach((ind, i) => {
                if (i === currentIndex) ind.classList.add("active");
                else ind.classList.remove("active");
            });
        }

        function nextSlide() {
            currentIndex = (currentIndex + 1) % totalSlides;
            updateCarousel();
        }

        function prevSlide() {
            currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
            updateCarousel();
        }

        // äº‹ä»¶ç›‘å¬
        nextBtn?.addEventListener("click", () => {
            nextSlide();
            resetAutoPlay();
        });

        prevBtn?.addEventListener("click", () => {
            prevSlide();
            resetAutoPlay();
        });

        indicators.forEach((ind) => {
            ind.addEventListener("click", (e) => {
                const target = e.target as HTMLElement;
                const index = parseInt(target.dataset.index || "0");
                currentIndex = index;
                updateCarousel();
                resetAutoPlay();
            });
        });

        // è‡ªåŠ¨æ’­æ”¾
        let autoPlayInterval: ReturnType<typeof setInterval>;

        function startAutoPlay() {
            autoPlayInterval = setInterval(nextSlide, 5000); // 5ç§’åˆ‡æ¢ä¸€æ¬¡
        }

        function stopAutoPlay() {
            clearInterval(autoPlayInterval);
        }

        function resetAutoPlay() {
            stopAutoPlay();
            startAutoPlay();
        }

        // è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ
        let touchStartX = 0;
        let touchEndX = 0;

        track.addEventListener(
            "touchstart",
            (e) => {
                touchStartX = e.changedTouches[0].screenX;
                stopAutoPlay();
            },
            { passive: true },
        );

        track.addEventListener(
            "touchend",
            (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
                startAutoPlay();
            },
            { passive: true },
        );

        function handleSwipe() {
            if (touchEndX < touchStartX - 50) nextSlide();
            if (touchEndX > touchStartX + 50) prevSlide();
        }

        // å¯åŠ¨
        startAutoPlay();

        // é¼ æ ‡æ‚¬åœæš‚åœ
        track.addEventListener("mouseenter", stopAutoPlay);
        track.addEventListener("mouseleave", startAutoPlay);
    }

    // åˆå§‹åŒ–
    document.addEventListener("DOMContentLoaded", initCarousel);
    document.addEventListener("astro:page-load", initCarousel);
</script>

<style>
    .seasons-carousel-container {
        position: relative;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        overflow: hidden;
        padding: 2rem 0;
    }

    .carousel-viewport {
        overflow: hidden;
        border-radius: 1rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    :global([data-theme="light"]) .carousel-viewport {
        background: #fff;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .carousel-track {
        display: flex;
        transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        width: 100%;
    }

    .carousel-slide {
        min-width: 100%;
        box-sizing: border-box;
        padding: 2rem;
    }

    .season-card {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .season-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 1rem;
    }

    :global([data-theme="light"]) .season-header {
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .season-year {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--sl-color-accent);
        line-height: 1;
    }

    .season-badge {
        background: var(--sl-color-accent);
        color: #fff;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
    }

    :global([data-theme="light"]) .season-badge {
        color: #000;
    }

    .season-content {
        display: flex;
        flex-direction: column;
        gap: 2.5rem;
    }

    /* å›¾ç‰‡åŒºåŸŸ */
    .season-gallery {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
    }

    @media (max-width: 768px) {
        .season-gallery {
            grid-template-columns: 1fr;
        }
    }

    .gallery-item {
        position: relative;
        border-radius: 0.75rem;
        overflow: hidden;
        aspect-ratio: 16/9;
    }

    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .gallery-item:hover img {
        transform: scale(1.05);
    }

    .gallery-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
        color: #fff;
        padding: 1rem;
        font-size: 0.9rem;
        font-weight: 600;
    }

    /* å›¢é˜Ÿä¿¡æ¯åŒºåŸŸ */
    .team-info {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .leadership {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
    }

    .leader-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: rgba(255, 255, 255, 0.05);
        padding: 0.75rem 1.25rem;
        border-radius: 0.75rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    :global([data-theme="light"]) .leader-card {
        background: rgba(0, 0, 0, 0.03);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .leader-icon {
        font-size: 1.5rem;
    }

    .leader-details {
        display: flex;
        flex-direction: column;
    }

    .leader-role {
        font-size: 0.75rem;
        text-transform: uppercase;
        opacity: 0.7;
        font-weight: 600;
    }

    .leader-name {
        font-weight: 700;
        font-size: 1rem;
        color: var(--sl-color-text);
    }

    /* æˆå‘˜åˆ—è¡¨ */
    .members-section {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 1rem;
        padding: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    :global([data-theme="light"]) .members-section {
        background: rgba(0, 0, 0, 0.02);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .members-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1.5rem;
    }

    .member-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .group-name {
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--sl-color-accent);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 0.25rem;
        margin-bottom: 0.25rem;
    }

    :global([data-theme="light"]) .group-name {
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .group-members {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .member-name {
        font-size: 0.85rem;
        opacity: 0.8;
        background: rgba(255, 255, 255, 0.05);
        padding: 0.1rem 0.4rem;
        border-radius: 4px;
    }

    :global([data-theme="light"]) .member-name {
        background: rgba(0, 0, 0, 0.05);
    }

    /* å¯¼èˆªæŒ‰é’® */
    .carousel-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: #fff;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
    }

    .carousel-nav:hover {
        background: var(--sl-color-accent);
        transform: translateY(-50%) scale(1.1);
    }

    .carousel-nav.prev {
        left: 10px;
    }
    .carousel-nav.next {
        right: 10px;
    }

    /* æŒ‡ç¤ºå™¨ */
    .carousel-indicators {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.8rem;
        margin-top: 1.5rem;
        height: 20px;
    }

    .indicator {
        width: 10px;
        height: 10px;
        padding: 0;
        margin: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        appearance: none;
        display: block;
    }

    :global([data-theme="light"]) .indicator {
        background: rgba(0, 0, 0, 0.2);
    }

    .indicator.active {
        background: var(--sl-color-accent);
        transform: scale(1.2);
    }

    @media (max-width: 640px) {
        .carousel-slide {
            padding: 1rem;
        }

        .season-year {
            font-size: 2rem;
        }

        .members-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
